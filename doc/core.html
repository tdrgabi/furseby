<!-- this file was generated automatically by noweave; better not edit it-->
<html><head><title>src/core.nw</title></head><body><pre><a name="NW1Go8cT-1p0Y9w-1" href="#NW1Go8cT-1p0Y9w-1"><dfn>&lt;*&gt;=</dfn></a>
<a name="NW1Go8cT-1p0Y9w-1-u1" href="#NW1Go8cT-4aLBOa-1"><i>&lt;CODE&gt;</i></a>
</pre><p>

<pre><a name="NW1Go8cT-4aLBOa-1" href="#NW1Go8cT-4aLBOa-1"><dfn>&lt;CODE&gt;=</dfn></a> <b>(<a href="#NW1Go8cT-1p0Y9w-1">&lt;-U</a>)</b>
(defpackage :furseby.core
  (:use :cl :gtk :gdk :gobject :iter :drakma :html :puri :xpath :iter :url-rewrite)
  (:export :search-site
           :search-all-sites
           :*sites*
           :make-site))

(in-package :furseby.core)

(defparameter *sites* '())

(defstruct site url xpath parse-func url-func)

(defun search-site (site criteria)
  (let* ((full-url (funcall (site-url-func site) (site-url site) criteria))
        (doc (parse-html (puri:parse-uri full-url)))
        (nodes (apply #'append (mapcar (lambda (x) (find-list doc x)) (site-xpath site)))))
  (funcall (site-parse-func site) nodes)))

(defun search-all-sites (criteria)
  (mapcar (lambda (site) (search-site site criteria)) *sites*))
</pre><p>


<ul>
<li><a href="#NW1Go8cT-1p0Y9w-1"><i>&lt;*&gt;</i></a>: <a href="#NW1Go8cT-1p0Y9w-1">D1</a>
<li><a href="#NW1Go8cT-4aLBOa-1"><i>&lt;CODE&gt;</i></a>: <a href="#NW1Go8cT-1p0Y9w-1">U1</a>, <a href="#NW1Go8cT-4aLBOa-1">D2</a>
</ul>
<ul>
</ul>
</body></html>

